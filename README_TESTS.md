# Автотесты для API internal-service

Этот проект содержит автоматизированные тесты для проверки функциональности Java-приложения `internal-0.0.1-SNAPSHOT.jar`.
Тесты написаны на Python с использованием фреймворка `pytest`. Управление зависимостями и окружением осуществляется через **uv**.

## Структура проекта

* `tests/` - Папка с тестами и вспомогательными модулями.
    * `test_api.py` - Основные сценарии тестирования.
    * `api_client.py` - Клиент для взаимодействия с API.
    * `mock_server.py` - Эмулятор внешнего сервиса (Mock).
    * `conftest.py` - Настройки окружения и фикстуры.
* `pyproject.toml` - Конфигурация проекта, зависимостей и инструментов (ruff, pytest).
* `.env` - Файл с переменными окружения (URL, токены, ключи).
* `.pre-commit-config.yaml` - Конфигурация хуков для git.

## Предварительные требования

1. Установленный **Python 3.12+**
2. Установленная утилита **[uv](https://github.com/astral-sh/uv)** (современный менеджер пакетов для Python).
3. Установленная **Java 17** (для запуска тестируемого приложения).
4. Файл приложения `internal-0.0.1-SNAPSHOT.jar` в корневой папке.

## Установка и настройка

1. Синхронизируйте окружение и установите зависимости:

```bash
uv sync
```

2. Установите git-хуки (pre-commit) для автоматической проверки кода:

```bash
uv run pre-commit install
```

3. Убедитесь, что файл `.env` существует и заполнен корректными данными (пример настроек создается автоматически).

## Запуск тестов

### 1. Запуск тестируемого приложения

В отдельном терминале запустите Java-приложение (параметры должны совпадать с `.env`):

```bash
java -jar -Dsecret=qazWSXedc -Dmock=http://localhost:8888/ internal-0.0.1-SNAPSHOT.jar
```
*Важно: Тесты автоматически поднимут Mock-сервер на порту 8888 (настраивается в .env).*

### 2. Выполнение тестов

Запустите тесты с помощью `uv`:

```bash
uv run pytest
```

### 3. Линтинг и качество кода

В проекте настроен **ruff** для линтинга и форматирования. Проверки выполняются автоматически при коммите.
Запустить проверки вручную:

```bash
# Запустить pre-commit на всех файлах
uv run pre-commit run --all-files

# Или запустить отдельно ruff
uv run ruff check .
```

### 4. Генерация отчета Allure

Чтобы сформировать красивый HTML-отчет о результатах:

```bash
# Генерация и открытие отчета в браузере
allure serve allure-results
```
*(Требуется установленная утилита Allure)*

## Описание сценариев

Тесты покрывают следующие области:
* **Positive Flow:** Успешная аутентификация, выполнение действий, выход из системы.
* **Negative Flow:** Попытка действий без авторизации, ошибки внешнего сервиса.
* **Validation:** Проверка длины и формата токена.
* **Security:** Проверка доступа без API-ключа или с неверным ключом.
